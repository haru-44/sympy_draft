# 最後、簡単化できる

mul = pow(1 if p == 2 and q >= 3 else -1, eq_1, modulo)
return (pow(p, e0, modulo) * mul * prod) % modulo
